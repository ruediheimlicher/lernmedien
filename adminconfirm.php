<?/*Admin confirm Datenbank Lernmedien*//* verbinden mit db */		$db = mysql_connect("localhost","ruediheimlicher","RivChuv4");	/* nun ist der zugang zum db-server in der variable $db gespeichert */	mysql_set_charset('utf8',$db);	/* hier wird nun die eigentliche db ausgewählt */	mysql_select_db("ruediheimlicher_lernmedien", $db); ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head>  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Lernmedien Adminconfirm</title> <link href="lernmedien.css" rel="stylesheet" type="text/css" /></head><body class="liste">			<div><h1 class="lernmedien">Lernmedien</h1></div>	<h2 class="lernmedien">Admin confirm</h2>				<?#var_dump($_POST);$task =  $_POST['task'];#print 'task: '.$task.'<br>';$taskradio = $_POST['changeradio'];#print 'taskradio: '.$taskradio.'<br>';$changeoption = $_POST['changeoption'];#print 'changeoption: '.$changeoption.'<br>';$deleteangabe = $_POST['delete'];#print 'deleteangabe: '.$deleteangabe.'<br>';/*print 'task: '.$task.'<br>';$choose =  array($_POST['index']);#$choosestring = implode(', ',$choose);print 'choose: '.$choose[1][1].' count: '.count($choose[0]).'<br>';print_r($choose[0]);print '<br>';$index =  array($_POST['index']);print_r($index);print '<br>';print 'index: '.count($index).' zeile:  '.$index[0][0].'<br>';$test =  $_POST['test'];print 'test: '.$test.'<br>';*/# Kontrolle$artwhitelist  =   array('Dokument','CD','Werkstatt');$stufewhitelist = array('U','M','O',' ');$gruppewhitelist = array('Holz','Ton','Papier','Textil');$namemuster = '/^[a-z]{2}$/';$textmuster = '/^[0-9A-Za-zäöüÄÖÜ ,\.\?]+$/';$preismuster = '/^[0-9.]*$/';$stufemuster = '/^[UOMS ]*$/';$beschreibungmuster = '/^[0-9A-Za-zäöüÄÖÜ ,\.\?\+\(\)\*=]*$/';/*^ : start of string[ : beginning of character groupa-z : any lowercase letterA-Z : any uppercase letter0-9 : any digit_ : underscore] : end of character group* : zero or more of the given characters$ : end of string*/$errtask="";if ($task == 'new'){	#print'neuer Datensatz<br>';		#print '<h2 class="lernmedien">neuer Datensatz eingef&uuml;gt</h2>';	#$index = $_POST['index'];	$name = $_POST['neuername'];	$art = $_POST['neueart'];	$gruppe = $_POST['neuegruppe'];	$stufe = $_POST['neuestufe'];	$preis = $_POST['neuerpreis']+0;	$beschreibung = $_POST['neuebeschreibung'];			print '<p class = "liste">index:*'. $index.'*</p>';	print '<p class = "liste">name:*'. $name.'*</p>';	print '<p class = "liste">art:*'. $art.'*</p>';	print '<p class = "liste">gruppe:*'. $gruppe.'*</p>';	print '<p class = "liste">stufe:*'. $stufe.'*</p>';	print '<p class = "liste">preis:*'. $preis.'*</p>';	print '<p class = "liste">beschreibung:*'. $beschreibung.'*</p>';		$eingabe=array($_POST['eingabe']);	#print_r($eingabe);	/*	$name=mysql_real_escape_string($name);	$art=mysql_real_escape_string($art);	$gruppe=mysql_real_escape_string($gruppe);	$beschreibung=mysql_real_escape_string($beschreibung);	*/	# Eingabe checken	$resultat=0; 	$eingabefehler='';	$fehlerlaenge=strlen($eingabefehler);	#print 'Fehlerstring start: '.$eingabefehler.'<br>';	# name		if (strlen($name)==0)	{		$eingabefehler .= 'Das Feld für den Namen ist leer.<br>'; 	}	 	else if (!preg_match($textmuster,$name))	{		$eingabefehler .= 'Das Feld für den Namen enthält ungültige Zeichen.<br>'; 	}		# Art	if (strlen($art)==0)	{		$eingabefehler .= 'Das Feld für die Art ist leer.<br>'; 	}	else if (! in_array($art, $artwhitelist) ) 	{		$eingabefehler .= 'Das Feld für die Art enthält einen falschen Begriff.<br>'; 	}		# stufe		if (strlen($stufe)==0)	{		$eingabefehler .= 'Das Feld für die Stufe ist leer.<br>'; 	}	/*	else if (! in_array($stufe, $stufewhitelist) ) 	{		$eingabefehler .= 'Das Feld für die Stufe enthält einen falschen Begriff.<br>'; 	}	*/	else if (!preg_match($stufemuster,$stufe))	{		$eingabefehler .= 'Das Feld für die Stufe enthält ungültige Zeichen.<br>'; 	}			# Gruppe	if (strlen($gruppe)==0)	{		$eingabefehler .= 'Das Feld für die Gruppe ist leer.<br>'; 	}	else if (! in_array($gruppe, $gruppewhitelist) ) 	{		$eingabefehler .= 'Das Feld für die Gruppe enthält einen falschen Begriff.<br>'; 	}				# preis	if ($preis==0)	{		$eingabefehler .= 'Der Wert für den Preis ist 0.<br>';	}	else if (!preg_match($preismuster,$preis))	{		$eingabefehler .= 'Das Feld für den Preis enthält ein falsches Zeichen.<br>'; 	} 		# beschreibung	if (strlen($beschreibung)==0)	{		$eingabefehler .= 'Das Feld für die Beschreibung ist leer.<br>'; 	}	else if (!preg_match($beschreibungmuster,$beschreibung))		{		$eingabefehler .= 'Das Feld für die Beschreibung enthält ein falsches Zeichen.<br>'; 	}		if (strlen($eingabefehler)> $eingabefehler)	{			print '<h3 class="lernmedien">Bei der Eingabe sind Fehler aufgetreten:</h3>';		print '<p class="liste">'. $eingabefehler.'</p';		$errtask="new";	}	else	{	# Muster	#$result_insert = mysql_query("INSERT INTO lernmedien (id, name, beschreibung, art, gruppe, preis, stufe, US, MS, OS) VALUES (NULL, 'Abc', 'ysdfghjkl', 'CD', 'Holz', '1', 'US MS', '1', '1', NULL)");			$result_insert = mysql_query("INSERT INTO lernmedien (id, name, beschreibung, art, gruppe, preis, stufe, US, MS, OS) VALUES (NULL, '$name', '$beschreibung', '$art', '$gruppe', '$preis', '$stufe', NULL, NULL, NULL)");			$resultat=mysql_affected_rows($db);	#print 'INSERT error: *'.mysql_error().'*<br>';	#print 'resultat affected_rows: *'.$resultat.'*<br>';			#print '<p>Rückgabe von INSERT: *'. $result_insert.'*</p>';		}	if ($resultat==1)	{		print '<h2 class="lernmedien">neuer Datensatz eingef&uuml;gt</h2>';				$index = $_POST['index'];		$name = $_POST['neuername'];		$art = $_POST['neueart'];		$gruppe = $_POST['neuegruppe'];		$stufe = $_POST['neuestufe'];		$preis = $_POST['neuerpreis'];		$beschreibung = $_POST['neuebeschreibung'];				print '<p class = "liste">neue Daten:</p>';		print '<p class = "liste">index:*'. $index.'*</p>';		print '<p class = "liste">name:*'. $name.'*</p>';		print '<p class = "liste">art:*'. $art.'*</p>';		print '<p class = "liste">gruppe:*'. $gruppe.'*</p>';		print '<p class = "liste">stufe:*'. $stufe.'*</p>';		print '<p class = "liste">preis:*'. $preis.'*</p>';		print '<p class = "liste">beschreibung:*'. $beschreibung.'*</p>';	}	else	{		print '<h3 class="lernmedien" <strong>Beim Einsetzen ist ein Fehler ist aufgetreten:</strong></h3><br>';		print '*'.mysql_error().'*<br>';	}	} # if newif ($task == 'change'){	#print'Datensatz ändern<br>';	$index = $_POST['index'];	$name = $_POST['changename'];	$art = $_POST['changeart'];	$gruppe = $_POST['changegruppe'];	$stufe = $_POST['changestufe'];	$preis = $_POST['changepreis'];	$beschreibung = $_POST['changebeschreibung'];		$result_change = mysql_query("UPDATE lernmedien SET name = '$name', art = '$art', gruppe = '$gruppe', stufe = '$stufe',preis = '$preis',beschreibung = '$beschreibung'  WHERE id = '$index'");	$resultat=mysql_affected_rows($db);	#print 'UPDATE error: *'.mysql_error().'*<br>';	#print 'resultat affected_rows: *'.$resultat.'*<br>';	print '<p class = "liste">Rückgabe von UPDATE: *'. $result_change.'*</p>';		if ($resultat==1)	{		print '<h2 class="lernmedien">Datensatz &auml;ndern</h2>';		/*		$index = $_POST['index'];		$name = $_POST['changename'];		$art = $_POST['changeart'];		$gruppe = $_POST['changegruppe'];		$stufe = $_POST['changestufe'];		$preis = $_POST['changepreis'];		$beschreibung = $_POST['changebeschreibung'];		*/		print '<p class = "liste">neue Daten:</p>';		#print '<p class = "liste">index:*'. $index.'*</p>';		print '<p class = "liste">name:*'. $name.'*</p>';		print '<p class = "liste">art:*'. $art.'*</p>';		print '<p class = "liste">gruppe:*'. $gruppe.'*</p>';		print '<p class = "liste">stufe:*'. $stufe.'*</p>';		print '<p class = "liste">preis:*'. $preis.'*</p>';		print '<p class = "liste">beschreibung:*'. $beschreibung.'*</p>';	}	else	{		print '<strong>Beim &Auml;ndern ist ein Fehler ist aufgetreten:<br>';		print '*'.mysql_error().'*<br>';	}						} # if changeif ($task == 'delete'){	#print'Datensatz loeschen<br>';	print '<h2 class="lernmedien">Datensatz l&ouml;schen:</h2>';	$index = $_POST['index'];	#print 'Datensatz ID: '.$index.'*<br>';	$deletename = $_POST['name'];	#print 'deletename: '.$deletename.'<br>';	$result_delete = mysql_query("DELETE FROM lernmedien  WHERE id = '$index'");	$resultat=mysql_affected_rows($db);	#print 'DELETE error: *'.mysql_error().'*<br>';	#print 'resultat affected_rows: *'.$resultat.'*<br>';	#print '<p>Rückgabe von DELETE: *'. $result_delete.'*</p>';	if ($resultat==1)	{		print '<h3 class="lernmedien">Datensatz '.$deletename.' ist gel&ouml;scht.</h3><br>';	}	else	{		print '<strong>Beim L&ouml; ist ein Fehler ist aufgetreten:<br>';		print '*'.mysql_error().'*<br>';	}	} # delete# Daten aendern# update students set first_name='Suba' where rec_id=678;#$db->set_charset("utf8"); # ******************************# Überprüfen# ******************************#print '<h2 class="lernmedien">Admin Kontrolle</h2>';/* sql-abfrage schicken */#$result_medien = mysql_query("SELECT * FROM lernmedien", $db);/* resultat in einer schleife auslesen */#print '<table width="759" border="1">';#while ($medien = mysql_fetch_array($result_medien) )#{#	$x=$medien['name'];#	print '<p>Das ist ein Eintrag. *'. $x.'*</p>';#}# neuer Datensatz#print '<h2 class="lernmedien">neuer Datensatz</h2>';#$index=0;#mysql_data_seek($result_medien,$index);// Tableheader#$tableheaderstring  = '<th class="text" width="60">Name</th>';#$tableheaderstring  = '<th class="text breite60">Name</th>';#zu lerntest.pl#print '<form action="/cgi-bin/lerntest.pl" method="post" accept-charset="utf-8">';print '<br><form action="admin.php" method = "post" >';if ($errtask== "new") # Namen zurueckgeben{	print '<input type="hidden" name="task" value ="err">';	print '<input type="hidden" name="sent" value ="err">';	print '<input type="hidden" name="errtask" value ="new">';	print '<input type="hidden" name="name" value ="'. $name.'">';	print '<input type="hidden" name="art" value ="'. $art.'">';	print '<input type="hidden" name="gruppe" value ="'. $gruppe.'">';	print '<input type="hidden" name="stufe" value ="'. $stufe.'">';	print '<input type="hidden" name="preis" value ="'. $preis.'">';	print '<input type="hidden" name="beschreibung" value ="'. $beschreibung.'">';	}else{	print '<input type="hidden" name="task" value ="done">';	print '<input type="hidden" name="sent" value ="done">';}print '<p class="nameneingabe"><input type="submit" value="zurück" name="textfile"></p></form>';/*perlscript aufrufen*/#$index=0;#mysql_data_seek($result_medien,$index);#$zeile= mysql_fetch_assoc($result_medien);#print "<p>Ausgabe Zeile:</p>";#print '<p>*name: *'.$zeile['name'].'* art: *'.$zeile['art'].'* PREIS: *'.$zeile['preis'].'*</p>';?></div><?php?><br><br>	<p>	<?		?>	</p>			<p>		</p></body></html>